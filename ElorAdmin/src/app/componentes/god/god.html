<div class="container mt-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col">
      <h1 class="display-6">üõ°Ô∏è Panel God</h1>
      <p class="text-muted">Administraci√≥n total del sistema</p>
    </div>
  </div>

  <!-- KPIs -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-md-4">
      <div class="card border-primary">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">üë• Total Alumnos</h6>
          <h2 class="card-title mb-0">{{ totales.alumnos }}</h2>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-4">
      <div class="card border-success">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">üë®‚Äçüè´ Total Profesores</h6>
          <h2 class="card-title mb-0">{{ totales.profesores }}</h2>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-4">
      <div class="card border-warning">
        <div class="card-body">
          <h6 class="card-subtitle mb-2 text-muted">üìÖ Reuniones Hoy</h6>
          <h2 class="card-title mb-0">{{ totales. reunionesHoy }}</h2>
        </div>
      </div>
    </div>
  </div>

  <hr>

  <!-- Secci√≥n Administradores -->
  <div class="row mb-3">
    <div class="col-12 col-md-6">
      <h4> Administradores <span class="badge bg-secondary">{{ admins.length }}</span></h4>
    </div>
    <div class="col-12 col-md-6 text-md-end">
      <button class="btn btn-primary" (click)="nuevoAdmin()" *ngIf="! showForm">
         Nuevo Administrador
      </button>
    </div>
  </div>

  <!-- Formulario crear/editar -->
  <div *ngIf="showForm" class="card mb-4 bg-light">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">{{ editando ? 'Editar' : ' Crear' }} Administrador</h5>
      <button type="button" class="btn-close" (click)="cancelar()"></button>
    </div>
    <div class="card-body">
      <form (ngSubmit)="guardarAdmin()" #adminForm="ngForm">
        <div class="row g-3">
          <div class="col-12 col-md-6">
            <label for="username" class="form-label">Usuario *</label>
            <input
              type="text"
              class="form-control"
              id="username"
              [(ngModel)]="form.username"
              name="username"
              required
              placeholder="Ej: adminuser"
              [readonly]="editando"
              [class.is-invalid]="submitted && !form.username"
            />
          </div>

          <div class="col-12 col-md-6">
            <label for="email" class="form-label">Email *</label>
            <input
              type="email"
              class="form-control"
              id="email"
              [(ngModel)]="form.email"
              name="email"
              required
              placeholder="correo@ejemplo.com"
              [class.is-invalid]="submitted && !form.email"
            />
          </div>

          <div class="col-12 col-md-6">
            <label for="nombre" class="form-label">Nombre *</label>
            <input
              type="text"
              class="form-control"
              id="nombre"
              [(ngModel)]="form.nombre"
              name="nombre"
              required
              placeholder="Nombre"
              [class.is-invalid]="submitted && !form.nombre"
            />
          </div>

          <div class="col-12 col-md-6">
            <label for="apellidos" class="form-label">Apellidos *</label>
            <input
              type="text"
              class="form-control"
              id="apellidos"
              [(ngModel)]="form.apellidos"
              name="apellidos"
              required
              placeholder="Apellidos"
              [class.is-invalid]="submitted && !form.apellidos"
            />
          </div>

          <div class="col-12">
            <label for="password" class="form-label">
              Contrase√±a {{ editando ? '(dejar vac√≠o para no cambiar)' : '*' }}
            </label>
            <input
              type="password"
              class="form-control"
              id="password"
              [(ngModel)]="form.password"
              name="password"
              [required]="! editando"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
              [class.is-invalid]="submitted && !editando && !form.password"
            />
          </div>
        </div>

        <div *ngIf="formError" class="alert alert-danger mt-3 mb-0" role="alert">
          ‚ö†Ô∏è {{ formError }}
        </div>

        <div class="d-flex gap-2 mt-3">
          <button type="submit" class="btn btn-success">
            {{ editando ? ' Guardar' : ' Crear' }}
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancelar()">
            ‚úï Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tabla administradores -->
  <div class="card">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Usuario</th>
              <th>Nombre Completo</th>
              <th>Email</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let admin of admins">
              <td>
                <strong>{{ admin.username }}</strong>
                <span *ngIf="admin.username === 'goduser'" class="badge bg-dark ms-2">God</span>
              </td>
              <td>{{ admin.nombre }} {{ admin.apellidos }}</td>
              <td>{{ admin.email }}</td>
              <td class="text-end">
                <button 
                  class="btn btn-sm btn-outline-secondary me-1" 
                  (click)="editarAdmin(admin)"
                  title="Editar"
                >
                  
                </button>
                <button 
                  *ngIf="admin.username !== 'goduser'"
                  class="btn btn-sm btn-outline-danger" 
                  (click)="borrarAdmin(admin)"
                  title="Eliminar"
                >
                  
                </button>
              </td>
            </tr>
            <tr *ngIf="admins.length === 0">
              <td colspan="4" class="text-center text-muted py-4">
                No hay administradores registrados
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

   <!-- Toast de confirmaci√≥n -->
  <div 
    *ngIf="showToast" 
    class="toast-container position-fixed top-0 end-0 p-3"
    style="z-index: 9999">
    <div 
      class="toast show" 
      [class.bg-success]="toastType === 'success'"
      [class.bg-danger]="toastType === 'error'"
      role="alert">
      <div class="toast-header text-white" 
           [class.bg-success]="toastType === 'success'"
           [class.bg-danger]="toastType === 'error'">
        <strong class="me-auto">
          <i class="bi bi-{{ toastType === 'success' ? 'check-circle-fill' : 'exclamation-triangle-fill' }}"></i>
          {{ toastType === 'success' ? '√âxito' : 'Error' }}
        </strong>
        <button type="button" class="btn-close btn-close-white" (click)="cerrarToast()"></button>
      </div>
      <div class="toast-body text-white">
        {{ toastMessage }}
      </div>
    </div>
  </div>


</div>